# WAV文件播放问题解决方案

## 问题描述

在之前的版本中，处理后的WAV文件无法正常播放，主要原因是WAV文件头处理不正确：

1. 原代码假设WAV文件头结构是固定的，但实际上WAV文件可能包含额外的元数据
2. 没有正确更新文件大小信息
3. 使用了固定偏移量来定位音频数据，而不是动态查找数据块

## 已修复的问题

1. 完全重写了WAV文件读取代码，现在能够:
   - 正确解析RIFF、fmt和data块
   - 处理额外的元数据和非标准块
   - 准确定位音频数据

2. 改进了WAV文件写入代码，现在能够:
   - 生成标准兼容的WAV文件头
   - 正确计算和更新文件大小
   - 保持音频格式参数不变

3. 增强了错误处理:
   - 添加了更详细的错误消息
   - 检查音频通道数，只接受单声道音频
   - 验证数据块是否存在

## 使用要求

为获得最佳效果:

1. 输入WAV文件必须是:
   - 16位PCM格式
   - 单声道(mono)
   - 最好是48kHz采样率

2. 如果您的WAV文件不符合要求:
   - 可以使用SoX、FFmpeg或Audacity等工具转换格式
   - 例如，使用FFmpeg将立体声转换为单声道:
     ```bash
     ffmpeg -i stereo.wav -ac 1 -ar 48000 mono.wav
     ```
   - 或者使用我们提供的convert_audio.sh脚本进行转换

## 测试方法

使用以下命令测试您的WAV文件:

```bash
./denoise.sh input.wav output.wav
```

如果仍然遇到问题，请检查:
1. 输入文件格式是否符合要求
2. 是否有足够的磁盘空间
3. 文件权限是否正确 